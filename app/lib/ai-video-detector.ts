/**
 * Detector de vÃ­deos gerados por IA
 * Identifica vÃ­deos que provavelmente foram criados por inteligÃªncia artificial
 */

import { ViralVideo } from '@/app/types';

/**
 * Palavras-chave e padrÃµes que indicam vÃ­deo gerado por IA
 */
const AI_INDICATORS = {
  // Palavras-chave no tÃ­tulo
  titleKeywords: [
    'ai generated',
    'artificial intelligence',
    'synthetic',
    'deepfake',
    'automated',
    'machine learning',
    'neural network',
    'generated by ai',
    'ai created',
    'ai made',
    'computer generated',
    'virtual',
    'simulated',
    'gerado por ia',
    'inteligÃªncia artificial',
    'sintÃ©tico',
    'automatizado',
    'criado por ia',
    'feito por ia',
    'gerado automaticamente',
  ],
  
  // Palavras-chave na descriÃ§Ã£o
  descriptionKeywords: [
    'this video was generated',
    'created using ai',
    'ai technology',
    'generated content',
    'synthetic media',
    'deep learning',
    'este vÃ­deo foi gerado',
    'criado usando ia',
    'tecnologia de ia',
    'conteÃºdo gerado',
    'mÃ­dia sintÃ©tica',
  ],
  
  // PadrÃµes suspeitos no nome do canal
  channelPatterns: [
    /ai\s*channel/i,
    /bot\s*channel/i,
    /auto\s*generated/i,
    /synthetic\s*media/i,
    /machine\s*learning/i,
    /neural\s*network/i,
    /^[a-z0-9]{10,}$/i, // Nomes muito genÃ©ricos (sÃ³ letras/nÃºmeros)
  ],
  
  // PadrÃµes suspeitos no tÃ­tulo
  titlePatterns: [
    /^[A-Z0-9\s]{20,}$/, // TÃ­tulos em caps lock muito longos
    /^\d+\.\s*[A-Z]/, // TÃ­tulos que comeÃ§am com nÃºmero seguido de ponto
    /\[.*ai.*\]/i, // TÃ­tulos com [AI] ou similar
    /\(.*generated.*\)/i, // TÃ­tulos com (generated) ou similar
  ],
};

/**
 * Verifica se um vÃ­deo foi provavelmente gerado por IA
 */
export function isAIGenerated(video: ViralVideo): boolean {
  const title = (video.title || '').toLowerCase();
  const description = (video.description || '').toLowerCase();
  const channelTitle = (video.channelTitle || '').toLowerCase();
  
  let score = 0;
  
  // Verificar palavras-chave no tÃ­tulo
  const titleMatches = AI_INDICATORS.titleKeywords.filter(keyword => 
    title.includes(keyword.toLowerCase())
  );
  score += titleMatches.length * 3; // TÃ­tulo tem peso maior
  
  // Verificar palavras-chave na descriÃ§Ã£o
  const descMatches = AI_INDICATORS.descriptionKeywords.filter(keyword => 
    description.includes(keyword.toLowerCase())
  );
  score += descMatches.length * 2;
  
  // Verificar padrÃµes no nome do canal
  const channelMatches = AI_INDICATORS.channelPatterns.filter(pattern => 
    pattern.test(channelTitle)
  );
  score += channelMatches.length * 2;
  
  // Verificar padrÃµes no tÃ­tulo
  const titlePatternMatches = AI_INDICATORS.titlePatterns.filter(pattern => 
    pattern.test(video.title || '')
  );
  score += titlePatternMatches.length * 1;
  
  // Se score >= 3, provavelmente Ã© gerado por IA
  return score >= 3;
}

/**
 * Filtra vÃ­deos removendo os gerados por IA
 */
export function filterAIGenerated(videos: ViralVideo[], excludeAI: boolean): ViralVideo[] {
  if (!excludeAI) {
    return videos;
  }
  
  const before = videos.length;
  const filtered = videos.filter(video => !isAIGenerated(video));
  const removed = before - filtered.length;
  
  if (removed > 0) {
    console.log(`ğŸ¤– Filtro de IA: ${before} â†’ ${filtered.length} vÃ­deos (${removed} vÃ­deos de IA removidos)`);
  }
  
  return filtered;
}

